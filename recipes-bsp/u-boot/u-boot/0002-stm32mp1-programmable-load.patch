From baa2a2dae77055b8e4432a1e99a8e4fd5a0dcd45 Mon Sep 17 00:00:00 2001
From: Tristan Seifert <tristan@tseifert.me>
Date: Fri, 3 Jun 2022 18:41:32 -0700
Subject: [PATCH] stm32mp1 config stuff

---
 configs/stm32mp15_basic_defconfig | 61 +++++++++++++++++++++++--------
 1 file changed, 46 insertions(+), 15 deletions(-)

diff --git a/configs/stm32mp15_basic_defconfig b/configs/stm32mp15_basic_defconfig
index 1b1c255b98..1c097f7279 100644
--- a/configs/stm32mp15_basic_defconfig
+++ b/configs/stm32mp15_basic_defconfig
@@ -35,14 +35,13 @@ CONFIG_SPL_POWER=y
 CONFIG_SPL_SPI_FLASH_MTD=y
 CONFIG_SYS_SPI_U_BOOT_OFFS=0x80000
 CONFIG_FDT_SIMPLEFB=y
-CONFIG_SYS_PROMPT="STM32MP> "
+CONFIG_SYS_PROMPT="Loader> "
 CONFIG_CMD_ADTIMG=y
 CONFIG_CMD_ERASEENV=y
 CONFIG_CMD_NVEDIT_EFI=y
 CONFIG_CMD_MEMINFO=y
 CONFIG_CMD_MEMTEST=y
 CONFIG_CMD_UNZIP=y
-CONFIG_CMD_ADC=y
 CONFIG_CMD_CLK=y
 CONFIG_CMD_DFU=y
 CONFIG_CMD_FUSE=y
@@ -55,33 +54,25 @@ CONFIG_CMD_USB=y
 CONFIG_CMD_USB_MASS_STORAGE=y
 CONFIG_CMD_BMP=y
 CONFIG_CMD_CACHE=y
-CONFIG_CMD_EFIDEBUG=y
 CONFIG_CMD_TIME=y
 CONFIG_CMD_RNG=y
 CONFIG_CMD_TIMER=y
 CONFIG_CMD_PMIC=y
 CONFIG_CMD_REGULATOR=y
-CONFIG_CMD_EXT4_WRITE=y
 CONFIG_CMD_MTDPARTS=y
 CONFIG_CMD_LOG=y
-CONFIG_CMD_UBI=y
 # CONFIG_SPL_DOS_PARTITION is not set
 CONFIG_OF_LIVE=y
 CONFIG_OF_SPL_REMOVE_PROPS="interrupts interrupt-names interrupts-extended interrupt-controller \\\#interrupt-cells interrupt-parent dmas dma-names assigned-clocks assigned-clock-rates assigned-clock-parents hwlocks"
 CONFIG_ENV_IS_NOWHERE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_ENV_IS_IN_SPI_FLASH=y
-CONFIG_ENV_IS_IN_UBI=y
 CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
-CONFIG_ENV_UBI_PART="UBI"
-CONFIG_ENV_UBI_VOLUME="uboot_config"
-CONFIG_ENV_UBI_VOLUME_REDUND="uboot_config_r"
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_DEV=-1
 # CONFIG_SPL_ENV_IS_NOWHERE is not set
 # CONFIG_SPL_ENV_IS_IN_SPI_FLASH is not set
 CONFIG_TFTP_TSIZE=y
-CONFIG_STM32_ADC=y
 CONFIG_SET_DFU_ALT_INFO=y
 CONFIG_USB_FUNCTION_FASTBOOT=y
 CONFIG_FASTBOOT_BUF_ADDR=0xC0000000
@@ -110,10 +101,10 @@ CONFIG_STM32_SDMMC2=y
 CONFIG_MTD=y
 CONFIG_DM_MTD=y
 CONFIG_SYS_MTDPARTS_RUNTIME=y
-CONFIG_MTD_RAW_NAND=y
-CONFIG_NAND_STM32_FMC2=y
-CONFIG_SYS_NAND_ONFI_DETECTION=y
-CONFIG_MTD_SPI_NAND=y
+CONFIG_MTD_RAW_NAND=n
+CONFIG_NAND_STM32_FMC2=n
+CONFIG_SYS_NAND_ONFI_DETECTION=n
+CONFIG_MTD_SPI_NAND=n
 CONFIG_DM_SPI_FLASH=y
 CONFIG_SPI_FLASH_MACRONIX=y
 CONFIG_SPI_FLASH_SPANSION=y
@@ -162,7 +153,6 @@ CONFIG_BACKLIGHT_GPIO=y
 CONFIG_VIDEO_LCD_ORISETECH_OTM8009A=y
 CONFIG_VIDEO_LCD_RAYDIUM_RM68200=y
 CONFIG_VIDEO_STM32=y
-CONFIG_VIDEO_STM32_DSI=y
 CONFIG_VIDEO_STM32_MAX_XRES=1280
 CONFIG_VIDEO_STM32_MAX_YRES=800
 CONFIG_BMP_16BPP=y
@@ -176,3 +166,44 @@ CONFIG_FDT_FIXUP_PARTITIONS=y
 # CONFIG_LMB_USE_MAX_REGIONS is not set
 CONFIG_LMB_MEMORY_REGIONS=2
 CONFIG_LMB_RESERVED_REGIONS=16
+
+# enable framebuffer console
+
+# TCP/IP
+
+## network commands
+CONFIG_CMD_PING=y
+CONFIG_CMD_MDIO=y
+CONFIG_CMD_DHCP=y
+## boot via various network options
+CONFIG_CMD_PXE=y
+CONFIG_CMD_NFS=y
+CONFIG_CMD_TFTPBOOT=y
+
+# filesystems
+CONFIG_CMD_LSBLK=y
+
+## Generic filesystem stuff
+CONFIG_CMD_FS_GENERIC=y
+
+## squashfs
+CONFIG_FS_SQUASHFS=y
+
+## EROFS
+CONFIG_CMD_EROFS=y
+CONFIG_FS_EROFS=y
+CONFIG_FS_EROFS_ZIP=y
+
+## disable ext2+
+CONFIG_FS_EXT4=n
+
+## eMMC stuff
+CONFIG_CMD_BKOPS_ENABLE=y
+CONFIG_CMD_MMC_RPMB=y
+
+# kernel ASLR support
+CONFIG_CMD_KASLRSEED=y
+
+# disable some boot commands
+CONFIG_BOOTM_VXWORKS=n
+CONFIG_CMD_BOOTEFI=n
-- 
2.32.1 (Apple Git-133)


